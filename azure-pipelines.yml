
trigger:
    - main

#checkout multiple repositories in the pipeline
resources:
  repositories:
  - repository: azureSharedTemplates
    type: github
    endpoint: ACRCode
    name: ACRCode/ADOCS-templates
    branch: master

  - repository: InfrastureAsCode
    type: github
    endpoint: ACRCode
    name: ACRCode/InfrastructureAsCode
    branch: main


extends:
  template: shared-template.yml@azureSharedTemplates #Refer to the resources section repo 1)
  parameters:
    buildVersionMajor: 1
    buildVersionMinor: 0
    buildSteps:
      - checkout: self
          
      - task: CmdLine@2
        inputs:
          script: |
            pip install --platform manylinux2014_aarch64 --target=$(Build.SourcesDirectory)/src/python/lib/python3.9/site-packages --implementation cp --python-version 3.9 --only-binary=:all: --upgrade -r  $(Build.SourcesDirectory)\\requirements.txt
      
      - task: ArchiveFiles@2
        inputs:
          rootFolderOrFile: '$(Build.SourcesDirectory)/src'
          includeRootFolder: true
          archiveType: 'zip'
          archiveFile: '$(Build.ArtifactStagingDirectory)/$(Build.BuildNumber).zip'
          replaceExistingArchive: true
      - task: PublishBuildArtifacts@1
        inputs:
          PathtoPublish: '$(Build.ArtifactStagingDirectory)/$(Build.BuildNumber).zip'
          ArtifactName: 'AILAB.CloudModelEvaluation.CalculateMetrics'

    useSelfHostedAgents: false
    buildPoolImage: 'windows-latest'
    securityScanAgentPool: 'Local Agents'
    runCheckMarxScan: false
    runIQScan: false
